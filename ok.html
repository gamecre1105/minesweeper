<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>位置表示（概略のみ）</title>
<style>
  :root{
    --bg:#0f1220; --panel:#171a2b; --text:#e8ecf3; --muted:#a9b0c3; --accent:#4dd0e1; --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 10% -10%, #1e2240, transparent),var(--bg);color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans JP",Meiryo,Arial}
  .wrap{max-width:900px;margin:24px auto;padding:16px;display:grid;gap:16px}
  .card{background:var(--panel);border-radius:14px;padding:14px;box-shadow:0 8px 16px rgba(0,0,0,.25), inset 0 8px 22px rgba(0,0,0,.15)}
  h1{margin:4px 0 0;font-size:clamp(20px,5vw,28px)} h2{margin:.2rem 0 .6rem;font-size:1.05rem;color:#cfd5e7}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .item{display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);padding:8px 10px;border-radius:10px}
  .label{color:var(--muted)}
  .btn{cursor:pointer;border:none;border-radius:10px;padding:9px 12px;font-weight:700;background:linear-gradient(180deg,#2a2f52,#212544);color:var(--text);
    box-shadow:0 6px 18px rgba(0,0,0,.3)}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .ok{color:#a5d6a7}.warn{color:#ffcc80}.err{color:var(--danger)}
  pre{white-space:pre-wrap;word-break:break-all}
</style>
</head>
<body>
<div class="wrap">
  <h1>location tracking</h1>

  <div class="card">
    <h2>環境</h2>
    <div class="row">
      <div class="item"><span class="label">接続</span><span id="https" class="mono">checking…</span></div>
      <div class="item"><span class="label">タイムゾーン</span><span id="tz" class="mono">--</span></div>
      <div class="item"><span class="label">ローカル時刻</span><span id="now" class="mono">--</span></div>
      <div class="item"><span class="label">UA</span><span id="ua" class="mono">--</span></div>
    </div>
  </div>

  <div class="card">
    <h2>現在位置</h2>
    <div class="row" style="gap:8px;margin-bottom:6px">
      <button class="btn" id="btnIp2">ipwho.is で取得</button>
      <button class="btn" id="btnClear2">表示クリア</button>
    </div>
    <pre id="ipOut" class="mono"></pre>
    <div class="mono" style="color:#a9b0c3">
      送信完了
    </div>
  </div>
</div>

<script>
(()=>{
  // ====== 環境表示 ======
  const elHttps = document.getElementById('https');
  const elTz = document.getElementById('tz');
  const elNow = document.getElementById('now');
  const elUA = document.getElementById('ua');

  const isHttps = location.protocol === 'https:' || location.hostname === 'localhost';
  elHttps.textContent = isHttps ? 'HTTPS ✅' : (location.protocol + ' ⚠︎');
  elHttps.className = 'mono ' + (isHttps ? 'ok' : 'warn');

  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';
  const offMin = -new Date().getTimezoneOffset();
  const sign = offMin >= 0 ? '+' : '-';
  const h = String(Math.floor(Math.abs(offMin)/60)).padStart(2,'0');
  const m = String(Math.abs(offMin)%60).padStart(2,'0');
  const utc = `UTC${sign}${h}${m==='00'?'':':'+m}`;
  const abbr = (tz==='Asia/Tokyo') ? 'JST' : utc;
  elTz.textContent = `${abbr} (${utc})`;
  elUA.textContent = navigator.userAgent;

  function tick(){
    elNow.textContent = new Date().toLocaleString();
    requestAnimationFrame(()=>setTimeout(tick,500));
  }
  tick();

  // ====== 概略位置（IPベース：ipwho.isのみ） ======
  const ipOut = document.getElementById('ipOut');
  const val = (x)=> (x===null || x===undefined ? '-' : x);

  async function ipwho(){
    ipOut.textContent = 'ipwho.is から取得中…';
    try{
      const r = await fetch('https://ipwho.is/');
      if(!r.ok) throw new Error(`HTTP ${r.status}`);
      const d = await r.json();
      ipOut.textContent =
`現在位置: ${d.success ? 'OK' : '失敗'} (ipwho.is)
${(d.region||'-')}, ${(d.country||'-')}
現在位置取得しました。: ${val(d.latitude)}, lng: ${val(d.longitude)}
ISP: ${((d.connection && d.connection.isp) ? d.connection.isp : '-')}
 位置送信中・・・`;
    }catch(e){
      ipOut.textContent = `ipwho.is: 失敗
${e}`;
    }
  }

  const btn2 = document.getElementById('btnIp2');
  const btnClear = document.getElementById('btnClear2');
  if(btn2) btn2.addEventListener('click', ()=>{ ipwho(); });
  if(btnClear) btnClear.addEventListener('click', ()=>{ ipOut.textContent=''; });

  // ====== 自動実行（ページを開いたら即取得） ======
  ipwho();
})();
</script>
</body>
</html>
